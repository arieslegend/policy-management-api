<div class="client-dashboard">
  <header class="dashboard-header">
    <div class="header-content">
      <div class="user-welcome">
        <h1 class="dashboard-title">Mis Pólizas</h1>
        <p class="welcome-text">Bienvenido, {{ (user$ | async)?.fullName }}</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-edit-profile" (click)="openEditModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
          Editar Perfil
        </button>
        <button class="btn btn-logout" (click)="logout()">Cerrar sesión</button>
      </div>
    </div>
  </header>

  <main class="dashboard-content">
    <div class="stats-grid">
      <div class="stat-card active">
        <div class="stat-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3>{{ (activePoliciesCount$ | async) || 0 }}</h3>
          <p>Pólizas Activas</p>
        </div>
      </div>
      
      <div class="stat-card cancelled">
        <div class="stat-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3>{{ (cancelledPoliciesCount$ | async) || 0 }}</h3>
          <p>Pólizas Canceladas</p>
        </div>
      </div>
    </div>

    <section class="policies-section">
      <div class="section-header">
        <h2 class="section-title">Mis Pólizas</h2>
      </div>
      
      <div class="policies-grid" *ngIf="policies$ | async as policies; else loading">
        <div class="policy-card" *ngFor="let policy of policies">
          <div class="policy-header">
            <div class="policy-type">
              <div class="type-icon" [ngClass]="getTypeIconClass(policy.type)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <div class="policy-info">
                <h3 class="policy-title">{{ getPolicyTypeName(policy.type) }}</h3>
                <p class="policy-id">Póliza #{{ policy.id }}</p>
              </div>
            </div>
            <div class="policy-status">
              <span class="status-badge" [ngClass]="getStatusClass(policy.status)">
                <span class="status-dot"></span>
                {{ getPolicyStatusName(policy.status) }}
              </span>
            </div>
          </div>
          
          <div class="policy-details">
            <div class="detail-row">
              <span class="detail-label">Inicio</span>
              <span class="detail-value">{{ formatDate(policy.startDate) }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Vencimiento</span>
              <span class="detail-value">{{ formatDate(policy.endDate) }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Monto Asegurado</span>
              <span class="detail-value amount">${{ policy.insuredAmount | number }}</span>
            </div>
          </div>
          
          <div class="policy-actions">
            <button class="btn btn-danger" 
                    *ngIf="policy.status === 0" 
                    (click)="cancelPolicy(policy.id)">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              Cancelar
            </button>
          </div>
        </div>
      </div>
      
      <ng-template #loading>
        <div class="loading-state">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
          <p class="mt-3 text-muted">Cargando pólizas...</p>
        </div>
      </ng-template>
    </section>

    <!-- Modal para editar información personal -->
    <div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3 class="modal-title">Editar Información Personal</h3>
          <button class="btn-close" (click)="closeEditModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        
        <form [formGroup]="editForm" (ngSubmit)="savePersonalInfo()" class="edit-form">
          <div class="form-group">
            <label for="phone">Teléfono</label>
            <input 
              id="phone" 
              type="tel" 
              formControlName="phone" 
              class="form-control"
              placeholder="+1 234 567 8900"
              [class.is-invalid]="editForm.get('phone')?.invalid && editForm.get('phone')?.touched"
            >
            <div class="invalid-feedback" *ngIf="editForm.get('phone')?.invalid && editForm.get('phone')?.touched">
              <span *ngIf="editForm.get('phone')?.errors?.['required']">El teléfono es requerido</span>
              <span *ngIf="editForm.get('phone')?.errors?.['pattern']">Formato de teléfono inválido</span>
            </div>
          </div>

          <div class="form-group">
            <label for="email">Correo electrónico</label>
            <input 
              id="email" 
              type="email" 
              formControlName="email" 
              class="form-control"
              placeholder="correo@ejemplo.com"
              [class.is-invalid]="editForm.get('email')?.invalid && editForm.get('email')?.touched"
            >
            <div class="invalid-feedback" *ngIf="editForm.get('email')?.invalid && editForm.get('email')?.touched">
              <span *ngIf="editForm.get('email')?.errors?.['required']">El correo es requerido</span>
              <span *ngIf="editForm.get('email')?.errors?.['email']">Formato de correo inválido</span>
            </div>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn btn-outline-secondary" (click)="closeEditModal()">
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="editForm.invalid">
              Guardar Cambios
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="loading-overlay" *ngIf="isLoading$ | async">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>
  </main>
</div>
